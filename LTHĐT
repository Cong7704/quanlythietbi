<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Smart Lighting System</title>
</head>
<body>
  <h1>Smart Lighting System</h1>

  <button onclick="connectWallet()">ğŸ”Œ Káº¿t ná»‘i vÃ­</button><br><br>

  <div>
    <input type="text" id="deviceId" placeholder="Nháº­p Device ID">
    <button onclick="registerDevice()">ğŸ“ ÄÄƒng kÃ½ thiáº¿t bá»‹</button>
  </div><br>

  <div>
    <button onclick="turnOn()">ğŸ’¡ Báº­t thiáº¿t bá»‹</button>
    <button onclick="turnOff()">ğŸ’¤ Táº¯t thiáº¿t bá»‹</button>
  </div><br>

  <div>
    <button onclick="getStatus()">ğŸ“Š Láº¥y tráº¡ng thÃ¡i</button>
    <pre id="statusOutput"></pre>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <script>
    let web3;
    let contract;
    const contractAddress = "0xDA0bab807633f07f013f94DD0E6A4F96F8742B53";
    const abi = [
      {
        "inputs": [{"internalType":"string","name":"_deviceId","type":"string"}],
        "name":"registerDevice","outputs":[],"stateMutability":"nonpayable","type":"function"
      },
      {
        "inputs":[],"name":"turnOnDevice","outputs":[],"stateMutability":"nonpayable","type":"function"
      },
      {
        "inputs":[],"name":"turnOffDevice","outputs":[],"stateMutability":"nonpayable","type":"function"
      },
      {
        "inputs":[],"name":"getDeviceStatus",
        "outputs":[
          {"internalType":"string","name":"deviceId","type":"string"},
          {"internalType":"bool","name":"isOn","type":"bool"},
          {"internalType":"uint256","name":"usageHours","type":"uint256"},
          {"internalType":"bool","name":"maintenanceNeeded","type":"bool"}
        ],
        "stateMutability":"view","type":"function"
      }
    ];

    async function connectWallet() {
      if (window.ethereum) {
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        web3 = new Web3(window.ethereum);
        contract = new web3.eth.Contract(abi, contractAddress);
        alert("ğŸ” VÃ­ Ä‘Ã£ káº¿t ná»‘i!");
      } else {
        alert("âš ï¸ Báº¡n cáº§n MetaMask!");
      }
    }

    async function registerDevice() {
      const deviceId = document.getElementById("deviceId").value;
      const accounts = await web3.eth.getAccounts();
      await contract.methods.registerDevice(deviceId).send({ from: accounts[0] });
      alert("âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng!");
    }

    async function turnOn() {
      const accounts = await web3.eth.getAccounts();
      await contract.methods.turnOnDevice().send({ from: accounts[0] });
      alert("ğŸ’¡ Thiáº¿t bá»‹ Ä‘Ã£ báº­t!");
    }

    async function turnOff() {
      const accounts = await web3.eth.getAccounts();
      await contract.methods.turnOffDevice().send({ from: accounts[0] });
      alert("ğŸ’¤ Thiáº¿t bá»‹ Ä‘Ã£ táº¯t!");
    }

    async function getStatus() {
      const accounts = await web3.eth.getAccounts();
      const result = await contract.methods.getDeviceStatus().call({ from: accounts[0] });

      const display = `
ğŸ†” Device ID: ${result.deviceId}
ğŸ’¡ Tráº¡ng thÃ¡i: ${result.isOn ? "Báº­t" : "Táº¯t"}
â±ï¸ Sá»‘ giá» sá»­ dá»¥ng: ${result.usageHours}
ğŸ› ï¸ Cáº§n báº£o trÃ¬: ${result.maintenanceNeeded ? "CÃ³" : "KhÃ´ng"}
      `;
      document.getElementById("statusOutput").innerText = display;
    }
  </script>
</body>
</html>
